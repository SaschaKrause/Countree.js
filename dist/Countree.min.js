/*! Countree - v0.0.1 - 2013-02-11
* https://github.com/SaschaKrause/Countree
* Copyright (c) 2013 Sascha Krause; Licensed MIT */
(function(e){function r(e){function u(e,r,i,o){c(i,e);var u=o?s:0,a=function(){f(t.DOWN)?s=i-((new Date).getTime()-r.getTime()):f(t.UP)&&(s=(new Date).getTime()+u-r.getTime()),n.countResult.update(s),e(n.countResult),h(s,l(n.options),e)};return setInterval(a,n.options.updateIntervalInMilliseconds)}function f(e){return n.options.direction===e}function c(e,r){f(t.DOWN)?n.countResult.update(e):f(t.UP)&&n.countResult.update(0),r(n.countResult)}function h(e,r,i){f(t.UP)?e>=r&&(n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_FINISH,e),p()):f(t.DOWN)&&e<=0&&(n.countResult.update(0),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_FINISH,e),p())}function p(){clearInterval(r)}function d(e){var i=f(t.DOWN)?l(n.options):0;o=e,r&&clearInterval(r),r=u(o,new Date,l(n.options),!1),n.countResult.countNotifier.resetNotifier(),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_START,i),n.isCounting=!0}function v(){p(),n.isCounting&&n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_SUSPEND,s),n.isCounting=!1}function m(){!n.isCounting&&o&&(r=u(o,new Date,s,!0),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_RESUME,s),n.isCounting=!0)}function g(e,t){n.countResult.countNotifier.addNotifier(e,t,n.options.direction)}var n=this,r,s=0,o;this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:t.UP,name:"untitled"},a(this.options,e),this.countResult=new i(this,l(this.options)),this.isCounting=!1,this.start=d,this.suspend=v,this.resume=m,this.notifyAt=g}function i(e,t){function a(e){return r=e,n.countNotifier.notifyIfNecessary(e),r}function f(){return i.update(r)}function l(){return new u(r)}function c(){return r}var n=this,r=0,i=new o;this.countNotifier=new s(e,this.millisecondsStartingPoint),this.update=a,this.getAsTimeObject=f,this.getMillisecondsLeft=c,this.getPassedTime=l}function s(e,n){function u(e,t,n){e.event?s.push({event:e.event,callback:t,countingDirection:n}):i.push({millisecondsToNotify:l(e),when:e.when||o.BEFORE_END,callback:t,alreadyFired:!1,countingDirection:n})}function a(){for(var e=0;e<i.length;++e)i[e].alreadyFired=!1;for(var t=0;t<i.length;++t)i[t].alreadyFired=!1}function f(e){var n={},s=!1,u=!1,a=!1,f=!1;for(var l=0;l<i.length;++l){n=i[l],s=!n.alreadyFired&&n.countingDirection===t.DOWN&&n.when===o.BEFORE_END&&n.millisecondsToNotify>=e,u=!n.alreadyFired&&n.countingDirection===t.DOWN&&n.when===o.AFTER_START&&r.millisecondsStartingPoint-n.millisecondsToNotify>=e,a=!n.alreadyFired&&n.countingDirection===t.UP&&n.when===o.BEFORE_END&&r.millisecondsStartingPoint-n.millisecondsToNotify<=e,f=!n.alreadyFired&&n.countingDirection===t.UP&&n.when===o.AFTER_START&&n.millisecondsToNotify<=e;if(s||u||a||f)n.alreadyFired=!0,n.callback(r.countreeReference,e)}}function c(e,t){for(var n=0;n<s.length;++n)s[n].event===e&&s[n].callback(r.countreeReference,t)}var r=this,i=[],s=[];this.millisecondsStartingPoint=n,this.countreeReference=e;var o={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.EVENT={ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend"},this.addNotifier=u,this.resetNotifier=a,this.notifyIfNecessary=f,this.fireNotificationEvent=c}function o(){function e(e){if(e>0){var t=e;this.milliseconds=parseInt(e.toString().substr(-3),10),t=Math.floor(t/1e3),this.seconds=t%60,t=Math.floor(t/60),this.minutes=t%60,t=Math.floor(t/60),this.hours=t%24,t=Math.floor(t/24),this.days=t}return this}function t(){return f(this.milliseconds,3)}function n(){return f(this.seconds,2)}function r(){return f(this.minutes,2)}function i(){return f(this.hours,2)}this.milliseconds=0,this.seconds=0,this.minutes=0,this.hours=0,this.days=0,this.update=e,this.getMillisecondsAsTripleDigitString=t,this.getSecondsAsDoubleDigitString=n,this.getMinutesAsDoubleDigitString=r,this.getHoursAsDoubleDigitString=i}function u(e){function t(t){return n.MILLISECONDS===t?e%1e3:n.SECONDS===t?Math.floor(e/1e3)%60:n.MINUTES===t?Math.floor(e/1e3/60)%60:n.HOURS===t?Math.floor(e/1e3/60/60)%24:n.DAYS===t?Math.floor(e/1e3/60/60/24):0}function r(e,n){return f(t(e),n)}this.getDigitForTimeUnit=t,this.getDigitForTimeUnitLeftFilled=r}function a(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function f(e,t){var n=""+e;while(n.length<t)n="0"+n;return n}function l(e){return e.milliseconds||0+(e.seconds||0)*1e3+(e.minutes||0)*6e4+(e.hours||0)*36e5+(e.days||0)*864e5}var t={DOWN:"down",UP:"up"},n={MILLISECONDS:"ms",SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d"};e.Countree=r,e.CountResult=i,e.TimeObject=o,e.TimeMeasurement=u,e.TIME_UNIT=n})(typeof exports=="object"&&exports||window);