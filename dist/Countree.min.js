/*! Countree 2013-04-01 */
(function(t){function e(t){function e(t,e,n,s){o(n,t);var u=s?D:0,a=function(){i(f.DOWN)?D=n-((new Date).getTime()-e.getTime()):i(f.UP)&&(D=(new Date).getTime()+u-e.getTime()),T.countResult.update(D),t(T.countResult),r(D,c(T.options),t)};return setInterval(a,T.options.updateIntervalInMilliseconds)}function i(t){return T.options.direction===t}function o(t,e){i(f.DOWN)?T.countResult.update(t):i(f.UP)&&T.countResult.update(0),e(T.countResult)}function r(t,e){i(f.UP)?t>=e&&(u(),T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_FINISH,t)):i(f.DOWN)&&0>=t&&(T.countResult.update(0),u(),T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_FINISH,t))}function u(){clearInterval(h)}function a(t){var n=i(f.DOWN)?c(T.options):0;S=t,h&&clearInterval(h),h=e(S,new Date,c(T.options),!1),T.countResult.countNotifier.resetNotifier(),T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_START,n),T.state=N.COUNTING}function l(){u(),T.state===N.COUNTING&&T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_SUSPEND,D),T.state=N.SUSPENDED}function d(){T.state===N.SUSPENDED&&S&&(h=e(S,new Date,D,!0),T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_RESUME,D),T.state=N.COUNTING)}function E(t,e){T.countResult.countNotifier.addNotifier(t,e,T.options.direction)}var h,S,T=this,D=0;this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:f.UP,name:"untitled"},this.state=N.NOT_STARTED,s(this.options,t),this.countResult=new n(this,c(this.options)),this.start=a,this.suspend=l,this.resume=d,this.notifyAt=E}function n(t,e){function n(t){return c=t,f.update(t),u.countNotifier.notifyIfNecessary(t),c}function r(){return c}function s(){return f}var u=this,c=0,f=new i;this.countNotifier=new o(t,e),this.update=n,this.getMillisecondsLeft=r,this.formattedTime=s}function i(){function t(t){c=t}function e(t){return f.getDigitFromMsForTimeUnit(c,a.DAYS,t)}function n(t){return f.getDigitFromMsForTimeUnit(c,a.HOURS,t)}function i(t){return f.getDigitFromMsForTimeUnit(c,a.MINUTES,t)}function o(t){return f.getDigitFromMsForTimeUnit(c,a.SECONDS,t)}function s(t){return f.getDigitFromMsForTimeUnit(c,a.MILLISECONDS,t)}function u(){return e()+", "+n(2)+":"+i(2)+":"+o(2)+":"+s(3)}var c=0,f=new r;this.update=t,this.getDays=e,this.getHours=n,this.getMinutes=i,this.getSeconds=o,this.getMilliSeconds=s,this.toString=u}function o(t,e){function n(t,e,n){t.event?a.push({event:t.event,callback:e,countingDirection:n}):u.push({millisecondsToNotify:c(t),when:t.when||N.BEFORE_END,callback:e,alreadyFired:!1,countingDirection:n})}function i(){for(var t=0;a.length>t;++t)a[t].alreadyFired=!1;for(var e=0;u.length>e;++e)u[e].alreadyFired=!1}function o(t){for(var e={},n=!1,i=!1,o=!1,r=!1,c=0;u.length>c;++c)e=u[c],n=!e.alreadyFired&&e.countingDirection===f.DOWN&&e.when===N.BEFORE_END&&e.millisecondsToNotify>=t,i=!e.alreadyFired&&e.countingDirection===f.DOWN&&e.when===N.AFTER_START&&s.millisecondsStartingPoint-e.millisecondsToNotify>=t,o=!e.alreadyFired&&e.countingDirection===f.UP&&e.when===N.BEFORE_END&&t>=s.millisecondsStartingPoint-e.millisecondsToNotify,r=!e.alreadyFired&&e.countingDirection===f.UP&&e.when===N.AFTER_START&&t>=e.millisecondsToNotify,(n||i||o||r)&&(e.alreadyFired=!0,e.callback(s.countreeReference,t))}function r(t,e){for(var n=0;a.length>n;++n)a[n].event===t&&a[n].callback(s.countreeReference,e)}var s=this,u=[],a=[];this.millisecondsStartingPoint=e,this.countreeReference=t;var N={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.EVENT={ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend"},this.addNotifier=n,this.resetNotifier=i,this.notifyIfNecessary=o,this.fireNotificationEvent=r}function r(){function t(t,e,n){var i=0;return a.MILLISECONDS===e?i=t%1e3:a.SECONDS===e?i=Math.floor(t/1e3)%60:a.MINUTES===e?i=Math.floor(t/1e3/60)%60:a.HOURS===e?i=Math.floor(t/1e3/60/60)%24:a.DAYS===e&&(i=Math.floor(t/1e3/60/60/24)),void 0===n?i:u(i,n)}this.getDigitFromMsForTimeUnit=t}function s(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function u(t,e){for(var n=""+t;e>n.length;)n="0"+n;return n}function c(t){return t.milliseconds||0+1e3*(t.seconds||0)+6e4*(t.minutes||0)+36e5*(t.hours||0)+864e5*(t.days||0)}var f={DOWN:"down",UP:"up"},a={MILLISECONDS:"ms",SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d"},N={COUNTING:"counting",SUSPENDED:"suspended",STOPPED:"stopped",NOT_STARTED:"not started"};"function"==typeof define&&define.amd?define([],function(){return e}):(t.Countree=e,t.CountResult=n)})("object"==typeof exports&&exports||window);