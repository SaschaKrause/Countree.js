/*! Countree 2013-04-01 */
(function(t){function n(t){function n(t,n,e,s){o(e,t);var u=s?T:0,f=function(){i(a.DOWN)?T=e-((new Date).getTime()-n.getTime()):i(a.UP)&&(T=(new Date).getTime()+u-n.getTime()),D.countResult.update(T),t(D.countResult),r(T,c(D.options),t)};return setInterval(f,D.options.updateIntervalInMilliseconds)}function i(t){return D.options.direction===t}function o(t,n){i(a.DOWN)?D.countResult.update(t):i(a.UP)&&D.countResult.update(0),n(D.countResult)}function r(t,n){i(a.UP)?t>=n&&u():i(a.DOWN)&&0>=t&&(D.countResult.update(0),u()),D.countResult.countNotifier.fireNotificationEvent(D.countResult.countNotifier.EVENT.ON_FINISH,t)}function u(){clearInterval(E)}function f(t){var e=i(a.DOWN)?c(D.options):0;S=t,E&&clearInterval(E),E=n(S,new Date,c(D.options),!1),D.countResult.countNotifier.resetNotifier(),D.countResult.countNotifier.fireNotificationEvent(D.countResult.countNotifier.EVENT.ON_START,e),D.state=l.COUNTING}function N(){u(),status===l.COUNTING&&D.countResult.countNotifier.fireNotificationEvent(D.countResult.countNotifier.EVENT.ON_SUSPEND,T),D.state=l.SUSPENDED}function d(){D.state===l.SUSPENDED&&S&&(E=n(S,new Date,T,!0),D.countResult.countNotifier.fireNotificationEvent(D.countResult.countNotifier.EVENT.ON_RESUME,T),D.state=l.COUNTING)}function h(t,n){D.countResult.countNotifier.addNotifier(t,n,D.options.direction)}var E,S,D=this,T=0;this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:a.UP,name:"untitled"},this.state=l.NOT_STARTED,s(this.options,t),this.countResult=new e(this,c(this.options)),this.start=f,this.suspend=N,this.resume=d,this.notifyAt=h}function e(t){function n(t){return u=t,c.update(t),s.countNotifier.notifyIfNecessary(t),u}function e(){return u}function r(){return c}var s=this,u=0,c=new i;this.countNotifier=new o(t,this.millisecondsStartingPoint),this.update=n,this.getMillisecondsLeft=e,this.formattedTime=r}function i(){function t(t){c=t}function n(t){return a.getDigitFromMsForTimeUnit(c,f.DAYS,t)}function e(t){return a.getDigitFromMsForTimeUnit(c,f.HOURS,t)}function i(t){return a.getDigitFromMsForTimeUnit(c,f.MINUTES,t)}function o(t){return a.getDigitFromMsForTimeUnit(c,f.SECONDS,t)}function s(t){return a.getDigitFromMsForTimeUnit(c,f.MILLISECONDS,t)}function u(){return n()+", "+e(2)+":"+i(2)+":"+o(2)+":"+s(3)}var c=0,a=new r;this.update=t,this.getDays=n,this.getHours=e,this.getMinutes=i,this.getSeconds=o,this.getMilliSeconds=s,this.toString=u}function o(t,n){function e(t,n,e){t.event?f.push({event:t.event,callback:n,countingDirection:e}):u.push({millisecondsToNotify:c(t),when:t.when||l.BEFORE_END,callback:n,alreadyFired:!1,countingDirection:e})}function i(){for(var t=0;f.length>t;++t)f[t].alreadyFired=!1;for(var n=0;u.length>n;++n)u[n].alreadyFired=!1}function o(t){for(var n={},e=!1,i=!1,o=!1,r=!1,c=0;u.length>c;++c)n=u[c],e=!n.alreadyFired&&n.countingDirection===a.DOWN&&n.when===l.BEFORE_END&&n.millisecondsToNotify>=t,i=!n.alreadyFired&&n.countingDirection===a.DOWN&&n.when===l.AFTER_START&&s.millisecondsStartingPoint-n.millisecondsToNotify>=t,o=!n.alreadyFired&&n.countingDirection===a.UP&&n.when===l.BEFORE_END&&t>=s.millisecondsStartingPoint-n.millisecondsToNotify,r=!n.alreadyFired&&n.countingDirection===a.UP&&n.when===l.AFTER_START&&t>=n.millisecondsToNotify,(e||i||o||r)&&(n.alreadyFired=!0,n.callback(s.countreeReference,t))}function r(t,n){for(var e=0;f.length>e;++e)f[e].event===t&&f[e].callback(s.countreeReference,n)}var s=this,u=[],f=[];this.millisecondsStartingPoint=n,this.countreeReference=t;var l={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.EVENT={ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend"},this.addNotifier=e,this.resetNotifier=i,this.notifyIfNecessary=o,this.fireNotificationEvent=r}function r(){function t(t,n,e){var i=0;return f.MILLISECONDS===n?i=t%1e3:f.SECONDS===n?i=Math.floor(t/1e3)%60:f.MINUTES===n?i=Math.floor(t/1e3/60)%60:f.HOURS===n?i=Math.floor(t/1e3/60/60)%24:f.DAYS===n&&(i=Math.floor(t/1e3/60/60/24)),void 0===e?i:u(i,e)}this.getDigitFromMsForTimeUnit=t}function s(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function u(t,n){for(var e=""+t;n>e.length;)e="0"+e;return e}function c(t){return t.milliseconds||0+1e3*(t.seconds||0)+6e4*(t.minutes||0)+36e5*(t.hours||0)+864e5*(t.days||0)}var a={DOWN:"down",UP:"up"},f={MILLISECONDS:"ms",SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d"},l={COUNTING:"counting",SUSPENDED:"suspended",STOPPED:"stopped",NOT_STARTED:"not started"};"function"==typeof define&&define.amd?define([],function(){return n}):(t.Countree=n,t.CountResult=e)})("object"==typeof exports&&exports||window);