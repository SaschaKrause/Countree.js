/*! Countree - v0.0.1 - 2013-02-11
* https://github.com/SaschaKrause/Countree
* Copyright (c) 2013 Sascha Krause; Licensed MIT */
(function(e){function r(e){function u(e,r,i,o){c(i,e);var u=o?s:0,a=function(){f(t.DOWN)?s=i-((new Date).getTime()-r.getTime()):f(t.UP)&&(s=(new Date).getTime()+u-r.getTime()),n.countResult.update(s),e(n.countResult),h(s,l(n.options),e)};return setInterval(a,n.options.updateIntervalInMilliseconds)}function f(e){return n.options.direction===e}function c(e,r){f(t.DOWN)?n.countResult.update(e):f(t.UP)&&n.countResult.update(0),r(n.countResult)}function h(e,r,i){f(t.UP)?e>=r&&(n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_FINISH,e),p()):f(t.DOWN)&&e<=0&&(n.countResult.update(0),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_FINISH,e),p())}function p(){clearInterval(r)}function d(e){var i=f(t.DOWN)?l(n.options):0;o=e,r&&clearInterval(r),r=u(o,new Date,l(n.options),!1),n.countResult.countNotifier.resetNotifier(),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_START,i),n.isCounting=!0}function v(){p(),n.isCounting&&n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_SUSPEND,s),n.isCounting=!1}function m(){!n.isCounting&&o&&(r=u(o,new Date,s,!0),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_RESUME,s),n.isCounting=!0)}function g(e,t){n.countResult.countNotifier.addNotifier(e,t,n.options.direction)}var n=this,r,s=0,o;this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:t.UP,name:"untitled"},a(this.options,e),this.countResult=new i(this,l(this.options)),this.isCounting=!1,this.start=d,this.suspend=v,this.resume=m,this.notifyAt=g}function i(e,t){function u(e){return r=e,i.update(e),n.countNotifier.notifyIfNecessary(e),r}function a(){return r}function f(){return i}var n=this,r=0,i=new s;this.countNotifier=new o(e,this.millisecondsStartingPoint),this.update=u,this.getMillisecondsLeft=a,this.formattedTime=f}function s(){function r(t){e=t}function i(r){return t.getDigitFromMsForTimeUnit(e,n.DAYS,r)}function s(r){return t.getDigitFromMsForTimeUnit(e,n.HOURS,r)}function o(r){return t.getDigitFromMsForTimeUnit(e,n.MINUTES,r)}function a(r){return t.getDigitFromMsForTimeUnit(e,n.SECONDS,r)}function f(r){return t.getDigitFromMsForTimeUnit(e,n.MILLISECONDS,r)}function l(){return i()+", "+s(2)+":"+o(2)+":"+a(2)+":"+f(3)}var e=0,t=new u;this.update=r,this.getDays=i,this.getHours=s,this.getMinutes=o,this.getSeconds=a,this.getMilliSeconds=f,this.toString=l}function o(e,n){function u(e,t,n){e.event?s.push({event:e.event,callback:t,countingDirection:n}):i.push({millisecondsToNotify:l(e),when:e.when||o.BEFORE_END,callback:t,alreadyFired:!1,countingDirection:n})}function a(){for(var e=0;e<i.length;++e)i[e].alreadyFired=!1;for(var t=0;t<i.length;++t)i[t].alreadyFired=!1}function f(e){var n={},s=!1,u=!1,a=!1,f=!1;for(var l=0;l<i.length;++l){n=i[l],s=!n.alreadyFired&&n.countingDirection===t.DOWN&&n.when===o.BEFORE_END&&n.millisecondsToNotify>=e,u=!n.alreadyFired&&n.countingDirection===t.DOWN&&n.when===o.AFTER_START&&r.millisecondsStartingPoint-n.millisecondsToNotify>=e,a=!n.alreadyFired&&n.countingDirection===t.UP&&n.when===o.BEFORE_END&&r.millisecondsStartingPoint-n.millisecondsToNotify<=e,f=!n.alreadyFired&&n.countingDirection===t.UP&&n.when===o.AFTER_START&&n.millisecondsToNotify<=e;if(s||u||a||f)n.alreadyFired=!0,n.callback(r.countreeReference,e)}}function c(e,t){for(var n=0;n<s.length;++n)s[n].event===e&&s[n].callback(r.countreeReference,t)}var r=this,i=[],s=[];this.millisecondsStartingPoint=n,this.countreeReference=e;var o={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.EVENT={ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend"},this.addNotifier=u,this.resetNotifier=a,this.notifyIfNecessary=f,this.fireNotificationEvent=c}function u(){function e(e,t,r){var i=0;return n.MILLISECONDS===t?i=e%1e3:n.SECONDS===t?i=Math.floor(e/1e3)%60:n.MINUTES===t?i=Math.floor(e/1e3/60)%60:n.HOURS===t?i=Math.floor(e/1e3/60/60)%24:n.DAYS===t&&(i=Math.floor(e/1e3/60/60/24)),r===undefined?i:f(i,r)}this.getDigitFromMsForTimeUnit=e}function a(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function f(e,t){var n=""+e;while(n.length<t)n="0"+n;return n}function l(e){return e.milliseconds||0+(e.seconds||0)*1e3+(e.minutes||0)*6e4+(e.hours||0)*36e5+(e.days||0)*864e5}var t={DOWN:"down",UP:"up"},n={MILLISECONDS:"ms",SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d"};e.Countree=r,e.CountResult=i})(typeof exports=="object"&&exports||window);