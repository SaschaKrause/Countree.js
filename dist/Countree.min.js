/*! Countree 2013-04-10 */
(function(t){function e(t){function e(t,e,n,u){o(n,t);var s=u?D:0,a=function(){i(f.DOWN)?D=n-((new Date).getTime()-e.getTime()):i(f.UP)&&(D=(new Date).getTime()+s-e.getTime()),R.countResult.update(D),t(R.countResult),r(D,c(R.options),t)};return setInterval(a,R.options.updateIntervalInMilliseconds)}function i(t){return R.options.direction===t}function o(t,e){i(f.DOWN)?R.countResult.update(t):i(f.UP)&&R.countResult.update(0),e(R.countResult)}function r(t,e){i(f.UP)?t>=e&&(s(),R.countResult.countNotifier.fireNotificationEvent(R.countResult.countNotifier.EVENT.ON_FINISH,t)):i(f.DOWN)&&0>=t&&(R.countResult.update(0),s(),R.countResult.countNotifier.fireNotificationEvent(R.countResult.countNotifier.EVENT.ON_FINISH,t))}function s(){S&&clearInterval(S)}function a(t){var n=i(f.DOWN)?c(R.options):0;T=t,s(),S=e(T,new Date,c(R.options),!1),R.countResult.countNotifier.resetNotifier(),R.countResult.countNotifier.fireNotificationEvent(R.countResult.countNotifier.EVENT.ON_START,n),R.state=N.COUNTING}function l(){s(),R.state===N.COUNTING&&R.countResult.countNotifier.fireNotificationEvent(R.countResult.countNotifier.EVENT.ON_SUSPEND,D),R.state=N.SUSPENDED}function E(){R.state===N.SUSPENDED&&T&&(S=e(T,new Date,D,!0),R.countResult.countNotifier.fireNotificationEvent(R.countResult.countNotifier.EVENT.ON_RESUME,D),R.state=N.COUNTING)}function d(){s();var t=i(f.DOWN)?c(R.options):0;R.countResult.countNotifier.fireNotificationEvent(R.countResult.countNotifier.EVENT.ON_RESET,t),R.countResult.update(t),R.state=N.RESETED}function h(t,e){R.countResult.countNotifier.addNotifier(t,e,R.options.direction)}var S,T,R=this,D=0;this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:f.UP,name:"untitled"},this.state=N.NOT_STARTED,u(this.options,t),this.countResult=new n(this,c(this.options)),this.start=a,this.suspend=l,this.resume=E,this.reset=d,this.notifyAt=h}function n(t,e){function n(t){return c=t,f.update(t),s.countNotifier.notifyIfNecessary(t),c}function r(){return c}function u(){return f}var s=this,c=0,f=new i;this.countNotifier=new o(t,e),this.update=n,this.getMillisecondsLeft=r,this.formattedTime=u}function i(){function t(t){c=t}function e(t){return f.getDigitFromMsForTimeUnit(c,a.DAYS,t)}function n(t){return f.getDigitFromMsForTimeUnit(c,a.HOURS,t)}function i(t){return f.getDigitFromMsForTimeUnit(c,a.MINUTES,t)}function o(t){return f.getDigitFromMsForTimeUnit(c,a.SECONDS,t)}function u(t){return f.getDigitFromMsForTimeUnit(c,a.MILLISECONDS,t)}function s(){return e()+", "+n(2)+":"+i(2)+":"+o(2)+":"+u(3)}var c=0,f=new r;this.update=t,this.getDays=e,this.getHours=n,this.getMinutes=i,this.getSeconds=o,this.getMilliSeconds=u,this.toString=s}function o(t,e){function n(t,e,n){t.event?a.push({event:t.event,callback:e,countingDirection:n}):s.push({millisecondsToNotify:c(t),when:t.when||N.BEFORE_END,callback:e,alreadyFired:!1,countingDirection:n})}function i(){for(var t=0;a.length>t;++t)a[t].alreadyFired=!1;for(var e=0;s.length>e;++e)s[e].alreadyFired=!1}function o(t){for(var e={},n=!1,i=!1,o=!1,r=!1,c=0;s.length>c;++c)e=s[c],n=!e.alreadyFired&&e.countingDirection===f.DOWN&&e.when===N.BEFORE_END&&e.millisecondsToNotify>=t,i=!e.alreadyFired&&e.countingDirection===f.DOWN&&e.when===N.AFTER_START&&u.millisecondsStartingPoint-e.millisecondsToNotify>=t,o=!e.alreadyFired&&e.countingDirection===f.UP&&e.when===N.BEFORE_END&&t>=u.millisecondsStartingPoint-e.millisecondsToNotify,r=!e.alreadyFired&&e.countingDirection===f.UP&&e.when===N.AFTER_START&&t>=e.millisecondsToNotify,(n||i||o||r)&&(e.alreadyFired=!0,e.callback(u.countreeReference,t))}function r(t,e){for(var n=0;a.length>n;++n)a[n].event===t&&a[n].callback(u.countreeReference,e)}var u=this,s=[],a=[];this.millisecondsStartingPoint=e,this.countreeReference=t;var N={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.EVENT={ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend",ON_RESET:"onReset"},this.addNotifier=n,this.resetNotifier=i,this.notifyIfNecessary=o,this.fireNotificationEvent=r}function r(){function t(t,e,n){var i=0;return a.MILLISECONDS===e?i=t%1e3:a.SECONDS===e?i=Math.floor(t/1e3)%60:a.MINUTES===e?i=Math.floor(t/1e3/60)%60:a.HOURS===e?i=Math.floor(t/1e3/60/60)%24:a.DAYS===e&&(i=Math.floor(t/1e3/60/60/24)),void 0===n?i:s(i,n)}this.getDigitFromMsForTimeUnit=t}function u(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function s(t,e){for(var n=""+t;e>n.length;)n="0"+n;return n}function c(t){return t.milliseconds||0+1e3*(t.seconds||0)+6e4*(t.minutes||0)+36e5*(t.hours||0)+864e5*(t.days||0)}var f={DOWN:"down",UP:"up"},a={MILLISECONDS:"ms",SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d"},N={COUNTING:"counting",SUSPENDED:"suspended",RESETED:"reseted",NOT_STARTED:"not started"};"function"==typeof define&&define.amd?define([],function(){return e}):(t.Countree=e,t.CountResult=n)})("object"==typeof exports&&exports||window);