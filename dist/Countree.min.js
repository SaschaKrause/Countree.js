/*! Countree - v0.0.1 - 2013-02-07
* https://github.com/SaschaKrause/Countree
* Copyright (c) 2013 Sascha Krause; Licensed MIT */
(function(e){function t(e){function f(e,n,i,s){l(i,e);var a=s?o:0,f=function(){t.options.direction===r.DOWN?o=i-((new Date).getTime()-n.getTime()):t.options.direction===r.UP&&(o=(new Date).getTime()+a-n.getTime()),t.countResult.update(o),e(t.countResult),c(o,u(t.options),e)};return setInterval(f,t.options.updateIntervalInMilliseconds)}function l(e,n){t.options.direction===r.DOWN?t.countResult.update(e):t.options.direction===r.UP&&t.countResult.update(0),n(t.countResult)}function c(e,n,i){t.options.direction===r.UP?e>=n&&(t.countResult.countNotifier.fireNotificationEvent(t.countResult.countNotifier.EVENT.ON_FINISH,e),h()):t.options.direction===r.DOWN&&e<=0&&(t.countResult.update(0),t.countResult.countNotifier.fireNotificationEvent(t.countResult.countNotifier.EVENT.ON_FINISH,e),h())}function h(){clearInterval(i)}function p(e){var n=t.options.direction===r.DOWN?u(t.options):0;a=e,i&&clearInterval(i),i=f(a,new Date,u(t.options),!1),t.countResult.countNotifier.resetNotifier(),t.countResult.countNotifier.fireNotificationEvent(t.countResult.countNotifier.EVENT.ON_START,n),t.isCounting=!0}function d(){h(),t.isCounting&&t.countResult.countNotifier.fireNotificationEvent(t.countResult.countNotifier.EVENT.ON_SUSPEND,o),t.isCounting=!1}function v(){!t.isCounting&&a&&(i=f(a,new Date,o,!0),t.countResult.countNotifier.fireNotificationEvent(t.countResult.countNotifier.EVENT.ON_RESUME,o),t.isCounting=!0)}function m(e,n){t.countResult.countNotifier.addNotifier(e,n,t.options.direction)}var t=this,r={DOWN:"down",UP:"up"},i,o=0,a;this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:r.UP,name:"untitled"},s(this.options,e),this.countResult=new n(this,u(this.options)),this.isCounting=!1,this.start=p,this.suspend=d,this.resume=v,this.notifyAt=m}function n(e,t){function u(e){return s=e,n.countNotifier.notifyIfNecessary(e),s}function a(){return o.update(s)}function f(){return s}var n=this,s=0,o=new i;this.countNotifier=new r(e,this.millisecondsStartingPoint),this.update=u,this.getAsTimeObject=a,this.getMillisecondsLeft=f}function r(e,t){function o(e,t,n){e.event?i.push({event:e.event,callback:t,countingDirection:n}):r.push({millisecondsToNotify:u(e),when:e.when||s.BEFORE_END,callback:t,alreadyFired:!1,countingDirection:n})}function a(){for(var e=0;e<r.length;++e)r[e].alreadyFired=!1;for(var t=0;t<r.length;++t)r[t].alreadyFired=!1}function f(e){var t={},i=!1,o=!1,u=!1,a=!1;for(var f=0;f<r.length;++f){t=r[f],i=!t.alreadyFired&&t.countingDirection==="down"&&t.when===s.BEFORE_END&&t.millisecondsToNotify>=e,o=!t.alreadyFired&&t.countingDirection==="down"&&t.when===s.AFTER_START&&n.millisecondsStartingPoint-t.millisecondsToNotify>=e,u=!t.alreadyFired&&t.countingDirection==="up"&&t.when===s.BEFORE_END&&n.millisecondsStartingPoint-t.millisecondsToNotify<=e,a=!t.alreadyFired&&t.countingDirection==="up"&&t.when===s.AFTER_START&&t.millisecondsToNotify<=e;if(i||o||u||a)t.alreadyFired=!0,t.callback(n.countreeReference,e)}}function l(e,t){for(var r=0;r<i.length;++r)i[r].event===e&&i[r].callback(n.countreeReference,t)}var n=this,r=[],i=[];this.millisecondsStartingPoint=t,this.countreeReference=e;var s={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.EVENT={ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend"},this.addNotifier=o,this.resetNotifier=a,this.notifyIfNecessary=f,this.fireNotificationEvent=l}function i(){function e(e){if(e>0){var t=e;this.milliseconds=parseInt(e.toString().substr(-3),10),t=Math.floor(t/1e3),this.seconds=t%60,t=Math.floor(t/60),this.minutes=t%60,t=Math.floor(t/60),this.hours=t%24,t=Math.floor(t/24),this.days=t}return this}function t(){return o(this.milliseconds,3)}function n(){return o(this.seconds,2)}function r(){return o(this.minutes,2)}function i(){return o(this.hours,2)}function s(){return this.days+" days,  "+this.getHoursAsDoubleDigitString()+":"+this.getMinutesAsDoubleDigitString()+":"+this.getSecondsAsDoubleDigitString()+":"+this.getMillisecondsAsTripleDigitString()}this.milliseconds=0,this.seconds=0,this.minutes=0,this.hours=0,this.days=0,this.update=e,this.getMillisecondsAsTripleDigitString=t,this.getSecondsAsDoubleDigitString=n,this.getMinutesAsDoubleDigitString=r,this.getHoursAsDoubleDigitString=i,this.toString=s}function s(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function o(e,t){var n=""+e;while(n.length<t)n="0"+n;return n}function u(e){return e.milliseconds||0+(e.seconds||0)*1e3+(e.minutes||0)*6e4+(e.hours||0)*36e5+(e.days||0)*864e5}e.Countree=t,e.CountResult=n,e.TimeObject=i})(typeof exports=="object"&&exports||window);