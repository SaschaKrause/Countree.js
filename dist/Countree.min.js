/*! Countree - v0.0.1 - 2013-02-05
* https://github.com/SaschaKrause/Countree
* Copyright (c) 2013 Sascha Krause; Licensed MIT */
(function(e){function t(e){function f(e,n,i,s){l(i,e);var a=s?o:0,f=function(){t.options.direction===r.DOWN?o=i-((new Date).getTime()-n.getTime()):t.options.direction===r.UP&&(o=(new Date).getTime()+a-n.getTime()),t.countResult.update(o),e(t.countResult),c(o,u(t.options),e)};return setInterval(f,t.options.updateIntervalInMilliseconds)}function l(e,n){t.options.direction===r.DOWN?t.countResult.update(e):t.options.direction===r.UP&&t.countResult.update(0),n(t.countResult)}function c(e,n,i){t.options.direction===r.UP?e>=n&&h():t.options.direction===r.DOWN&&e<=0&&(t.countResult.update(0),h())}function h(){clearInterval(i)}function p(e){a=e,i&&clearInterval(i),i=f(a,new Date,u(t.options),!1),t.countResult.countNotifier.resetNotifier(),t.isCounting=!0}function d(){h(),t.isCounting=!1}function v(){!t.isCounting&&a&&(i=f(a,new Date,o,!0),t.isCounting=!0)}function m(e,n){t.countResult.countNotifier.addNotifier(e,n,t.options.direction)}var t=this,r={DOWN:"down",UP:"up"},i,o=0,a;this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:r.UP,name:"untitled"},s(this.options,e),this.countResult=new n(this,u(this.options)),this.isCounting=!1,this.start=p,this.suspend=d,this.resume=v,this.notifyAt=m}function n(e,t){var n=this;this.overallMillisecondsLeft=0,this.millisecondsStartingPoint=t,this.countNotifier=new r(e,this.millisecondsStartingPoint),this.timeObject=new i,this.update=function(e){return n.overallMillisecondsLeft=e,n.countNotifier.checkIfNeedToNotify(e),n.overallMillisecondsLeft},this.getAsTimeObject=function(){return this.timeObject.update(this.overallMillisecondsLeft)}}function r(e,t){var n=this;this.millisecondsStartingPoint=t,this.notifyAtArray=[],this.countreeReference=e;var r={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.addNotifier=function(e,t,i){n.notifyAtArray.push({millisecondsToNotify:u(e),when:e.when||r.BEFORE_END,callback:t,alreadyFired:!1,countingDirection:i})},this.resetNotifier=function(){for(var e in n.notifyAtArray)n.notifyAtArray[e].alreadyFired=!1},this.checkIfNeedToNotify=function(e){var t={},i=!1,s=!1,o=!1,u=!1;for(var a in n.notifyAtArray){t=n.notifyAtArray[a],i=!t.alreadyFired&&t.countingDirection==="down"&&t.when===r.BEFORE_END&&t.millisecondsToNotify>=e,s=!t.alreadyFired&&t.countingDirection==="down"&&t.when===r.AFTER_START&&n.millisecondsStartingPoint-t.millisecondsToNotify>=e,o=!t.alreadyFired&&t.countingDirection==="up"&&t.when===r.BEFORE_END&&n.millisecondsStartingPoint-t.millisecondsToNotify<=e,u=!t.alreadyFired&&t.countingDirection==="up"&&t.when===r.AFTER_START&&t.millisecondsToNotify<=e;if(i||s||o||u)t.alreadyFired=!0,t.callback(n.countreeReference,e)}}}function i(){this.milliseconds=0,this.seconds=0,this.minutes=0,this.hours=0,this.days=0,this.update=function(e){if(e>0){var t=e;this.milliseconds=parseInt(e.toString().substr(-3),10),t=Math.floor(t/1e3),this.seconds=t%60,t=Math.floor(t/60),this.minutes=t%60,t=Math.floor(t/60),this.hours=t%24,t=Math.floor(t/24),this.days=t}return this},this.getMillisecondsAsTripleDigitString=function(){return o(this.milliseconds,3)},this.getSecondsAsDoubleDigitString=function(){return o(this.seconds,2)},this.getMinutesAsDoubleDigitString=function(){return o(this.minutes,2)},this.getHoursAsDoubleDigitString=function(){return o(this.hours,2)},this.toString=function(){return this.days+" days,  "+this.getHoursAsDoubleDigitString()+":"+this.getMinutesAsDoubleDigitString()+":"+this.getSecondsAsDoubleDigitString()+":"+this.getMillisecondsAsTripleDigitString()}}function s(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function o(e,t){var n=""+e;while(n.length<t)n="0"+n;return n}function u(e){return e.milliseconds||0+(e.seconds||0)*1e3+(e.minutes||0)*6e4+(e.hours||0)*36e5+(e.days||0)*864e5}e.Countree=t,e.CountResult=n,e.TimeObject=i})(typeof exports=="object"&&exports||window);