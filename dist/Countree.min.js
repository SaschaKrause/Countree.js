/*! Countree - v0.0.1 - 2013-02-10
* https://github.com/SaschaKrause/Countree
* Copyright (c) 2013 Sascha Krause; Licensed MIT */
(function(e){function n(e){function f(e,r,i,o){h(i,e);var u=o?s:0,f=function(){l(t.DOWN)?s=i-((new Date).getTime()-r.getTime()):l(t.UP)&&(s=(new Date).getTime()+u-r.getTime()),n.countResult.update(s),e(n.countResult),p(s,a(n.options),e)};return setInterval(f,n.options.updateIntervalInMilliseconds)}function l(e){return c(e),n.options.direction===e}function c(){return}function h(e,r){l(t.DOWN)?n.countResult.update(e):l(t.UP)&&n.countResult.update(0),r(n.countResult)}function p(e,r,i){l(t.UP)?e>=r&&(n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_FINISH,e),d()):l(t.DOWN)&&e<=0&&(n.countResult.update(0),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_FINISH,e),d())}function d(){clearInterval(i)}function v(e){var r=l(t.DOWN)?a(n.options):0;u=e,i&&clearInterval(i),i=f(u,new Date,a(n.options),!1),n.countResult.countNotifier.resetNotifier(),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_START,r),n.isCounting=!0}function m(){d(),n.isCounting&&n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_SUSPEND,s),n.isCounting=!1}function g(){!n.isCounting&&u&&(i=f(u,new Date,s,!0),n.countResult.countNotifier.fireNotificationEvent(n.countResult.countNotifier.EVENT.ON_RESUME,s),n.isCounting=!0)}function y(e,t){n.countResult.countNotifier.addNotifier(e,t,n.options.direction)}var n=this,i,s=0,u;this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:t.UP,name:"untitled"},o(this.options,e),this.countResult=new r(this,a(this.options)),this.isCounting=!1,this.start=v,this.suspend=m,this.resume=g,this.notifyAt=y}function r(e,t){function u(e){return r=e,n.countNotifier.notifyIfNecessary(e),r}function a(){return o.update(r)}function f(){return r}var n=this,r=0,o=new s;this.countNotifier=new i(e,this.millisecondsStartingPoint),this.update=u,this.getAsTimeObject=a,this.getMillisecondsLeft=f}function i(e,n){function u(e,t,n){e.event?s.push({event:e.event,callback:t,countingDirection:n}):i.push({millisecondsToNotify:a(e),when:e.when||o.BEFORE_END,callback:t,alreadyFired:!1,countingDirection:n})}function f(){for(var e=0;e<i.length;++e)i[e].alreadyFired=!1;for(var t=0;t<i.length;++t)i[t].alreadyFired=!1}function l(e){var n={},s=!1,u=!1,a=!1,f=!1;for(var l=0;l<i.length;++l){n=i[l],s=!n.alreadyFired&&n.countingDirection===t.DOWN&&n.when===o.BEFORE_END&&n.millisecondsToNotify>=e,u=!n.alreadyFired&&n.countingDirection===t.DOWN&&n.when===o.AFTER_START&&r.millisecondsStartingPoint-n.millisecondsToNotify>=e,a=!n.alreadyFired&&n.countingDirection===t.UP&&n.when===o.BEFORE_END&&r.millisecondsStartingPoint-n.millisecondsToNotify<=e,f=!n.alreadyFired&&n.countingDirection===t.UP&&n.when===o.AFTER_START&&n.millisecondsToNotify<=e;if(s||u||a||f)n.alreadyFired=!0,n.callback(r.countreeReference,e)}}function c(e,t){for(var n=0;n<s.length;++n)s[n].event===e&&s[n].callback(r.countreeReference,t)}var r=this,i=[],s=[];this.millisecondsStartingPoint=n,this.countreeReference=e;var o={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.EVENT={ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend"},this.addNotifier=u,this.resetNotifier=f,this.notifyIfNecessary=l,this.fireNotificationEvent=c}function s(){function e(e){if(e>0){var t=e;this.milliseconds=parseInt(e.toString().substr(-3),10),t=Math.floor(t/1e3),this.seconds=t%60,t=Math.floor(t/60),this.minutes=t%60,t=Math.floor(t/60),this.hours=t%24,t=Math.floor(t/24),this.days=t}return this}function t(){return u(this.milliseconds,3)}function n(){return u(this.seconds,2)}function r(){return u(this.minutes,2)}function i(){return u(this.hours,2)}function s(){return this.days+" days,  "+this.getHoursAsDoubleDigitString()+":"+this.getMinutesAsDoubleDigitString()+":"+this.getSecondsAsDoubleDigitString()+":"+this.getMillisecondsAsTripleDigitString()}this.milliseconds=0,this.seconds=0,this.minutes=0,this.hours=0,this.days=0,this.update=e,this.getMillisecondsAsTripleDigitString=t,this.getSecondsAsDoubleDigitString=n,this.getMinutesAsDoubleDigitString=r,this.getHoursAsDoubleDigitString=i,this.toString=s}function o(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function u(e,t){var n=""+e;while(n.length<t)n="0"+n;return n}function a(e){return e.milliseconds||0+(e.seconds||0)*1e3+(e.minutes||0)*6e4+(e.hours||0)*36e5+(e.days||0)*864e5}var t={DOWN:"down",UP:"up"};e.Countree=n,e.CountResult=r,e.TimeObject=s})(typeof exports=="object"&&exports||window);