/*! Countree 2013-04-16 */
(function(t){function n(t){function n(t,n,e){function u(){return a=(new Date).getTime()-t.getTime(),i(f.DOWN)?n-a:i(f.UP)?a+N:void 0}function s(){D=u(),T.countResult.update(D),R.invoke(T.countResult),r(D,c(T.options))}o(n,e);var a,N=e?D:0;return setInterval(s,T.options.updateIntervalInMilliseconds)}function i(t){return T.options.direction===t}function o(t,n){n||(i(f.DOWN)?T.countResult.update(t):i(f.UP)&&T.countResult.update(0),R.invoke(T.countResult))}function r(t,n){i(f.UP)?t>=n&&(s(),T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_FINISH,t)):i(f.DOWN)&&0>=t&&(T.countResult.update(0),s(),T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_FINISH,t))}function s(){S&&clearInterval(S)}function a(t){var e=i(f.DOWN)?c(T.options):0;R.set(t),s(),S=n(new Date,c(T.options),!1),T.countResult.countNotifier.resetNotifier(),T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_START,e),T.state=N.COUNTING}function l(){s(),T.state===N.COUNTING&&T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_SUSPEND,D),T.state=N.SUSPENDED}function d(){T.state===N.SUSPENDED&&R.get()&&(S=n(new Date,D,!0),T.countResult.countNotifier.fireNotificationEvent(T.countResult.countNotifier.EVENT.ON_RESUME,D),T.state=N.COUNTING)}function E(t,n){T.countResult.countNotifier.addNotifier(t,n,T.options.direction)}function h(t){u(T.options,t)}var S,T=this,D=0,R={value:void 0,set:function(t){this.value=t},get:function(){return this.value},invoke:function(t){this.value(t)}};this.version="0.0.1",this.options={milliseconds:0,seconds:0,minutes:0,hours:0,days:0,updateIntervalInMilliseconds:1e3,direction:f.UP,name:"untitled"},this.state=N.NOT_STARTED,u(this.options,t),this.countResult=new e(this,c(this.options)),this.start=a,this.suspend=l,this.resume=d,this.notifyAt=E,this.setOptions=h}function e(t,n){function e(t){return c=t,f.update(t),s.countNotifier.notifyIfNecessary(t),c}function r(){return c}function u(){return f}var s=this,c=0,f=new i;this.countNotifier=new o(t,n),this.update=e,this.getMillisecondsLeft=r,this.formattedTime=u}function i(){function t(t){c=t}function n(t){return f.getDigitFromMsForTimeUnit(c,a.DAYS,t)}function e(t){return f.getDigitFromMsForTimeUnit(c,a.HOURS,t)}function i(t){return f.getDigitFromMsForTimeUnit(c,a.MINUTES,t)}function o(t){return f.getDigitFromMsForTimeUnit(c,a.SECONDS,t)}function u(t){return f.getDigitFromMsForTimeUnit(c,a.MILLISECONDS,t)}function s(){return n()+", "+e(2)+":"+i(2)+":"+o(2)+":"+u(3)}var c=0,f=new r;this.update=t,this.getDays=n,this.getHours=e,this.getMinutes=i,this.getSeconds=o,this.getMilliSeconds=u,this.toString=s}function o(t,n){function e(t,n,e){t.event?a.push({event:t.event,callback:n,countingDirection:e}):s.push({millisecondsToNotify:c(t),when:t.when||N.BEFORE_END,callback:n,alreadyFired:!1,countingDirection:e})}function i(){for(var t=0;a.length>t;++t)a[t].alreadyFired=!1;for(var n=0;s.length>n;++n)s[n].alreadyFired=!1}function o(t){for(var n={},e=!1,i=!1,o=!1,r=!1,c=0;s.length>c;++c)n=s[c],e=!n.alreadyFired&&n.countingDirection===f.DOWN&&n.when===N.BEFORE_END&&n.millisecondsToNotify>=t,i=!n.alreadyFired&&n.countingDirection===f.DOWN&&n.when===N.AFTER_START&&u.millisecondsStartingPoint-n.millisecondsToNotify>=t,o=!n.alreadyFired&&n.countingDirection===f.UP&&n.when===N.BEFORE_END&&t>=u.millisecondsStartingPoint-n.millisecondsToNotify,r=!n.alreadyFired&&n.countingDirection===f.UP&&n.when===N.AFTER_START&&t>=n.millisecondsToNotify,(e||i||o||r)&&(n.alreadyFired=!0,n.callback(u.countreeReference,t))}function r(t,n){for(var e=0;a.length>e;++e)a[e].event===t&&a[e].callback(u.countreeReference,n)}var u=this,s=[],a=[];this.millisecondsStartingPoint=n,this.countreeReference=t;var N={BEFORE_END:"beforeEnd",AFTER_START:"afterStart"};this.EVENT={ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend",ON_RESET:"onReset"},this.addNotifier=e,this.resetNotifier=i,this.notifyIfNecessary=o,this.fireNotificationEvent=r}function r(){function t(t,n,e){var i=0;return a.MILLISECONDS===n?i=t%1e3:a.SECONDS===n?i=Math.floor(t/1e3)%60:a.MINUTES===n?i=Math.floor(t/1e3/60)%60:a.HOURS===n?i=Math.floor(t/1e3/60/60)%24:a.DAYS===n&&(i=Math.floor(t/1e3/60/60/24)),void 0===e?i:s(i,e)}this.getDigitFromMsForTimeUnit=t}function u(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function s(t,n){for(var e=""+t;n>e.length;)e="0"+e;return e}function c(t){return t.milliseconds||0+1e3*(t.seconds||0)+6e4*(t.minutes||0)+36e5*(t.hours||0)+864e5*(t.days||0)}var f={DOWN:"down",UP:"up"},a={MILLISECONDS:"ms",SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d"},N={COUNTING:"counting",SUSPENDED:"suspended",RESETED:"reseted",NOT_STARTED:"not started"};"function"==typeof define&&define.amd?define([],function(){return n}):(t.Countree=n,t.CountResult=e)})("object"==typeof exports&&exports||window);